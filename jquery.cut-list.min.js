(function(m,w,e){m.fn.cutList=function(){var t={moreBtnTitle:"Еще",showMoreOnHover:false,alwaysVisibleElem:e,onBeforeCalc:function(){},onBeforeOpen:function(){},onOpen:function(){},onBeforeClose:function(){},onClose:function(){},risezeDelay:50};var h=i(t,arguments[0]);function i(t,i){var e={};var s;for(s in t){if(Object.prototype.hasOwnProperty.call(t,s)){e[s]=t[s]}}for(s in i){if(Object.prototype.hasOwnProperty.call(i,s)){e[s]=i[s]}}return e}return this.each(function(){var t=m(this),i=m(this).clone(),s,e,n,o,l,d;c(t);function r(){clearTimeout(d);d=setTimeout(function(){f(t)},h.risezeDelay)}function c(i){if(!i.find(".cut-list__dropdown").length){i.append('<div style="display:none" class="cut-list__elem cut-list__dropdown"></div>').find(".cut-list__dropdown").append('<div class="cut-list__drop"></div>').find(".cut-list__drop").append('<div class="cut-list__drop-toggle">'+h.moreBtnTitle+"</div>").append('<div class="cut-list__more"><div class="cut-list__more-content"></div></div>')}i.addClass("cut-list").children().each(function(t){m(this).attr("data-index",t).addClass("cut-list__elem")});s=i.find(".cut-list__elem").length;index=s-1;if(i.find(h.alwaysVisibleElem).length>1)console.log("Внимание! Вами назначено несколько alwaysVisibleElem, будет использоваться только первый.");l=i.find(h.alwaysVisibleElem+":first").index();a(i);if(h.showMoreOnHover){i.find(".cut-list__drop").hover(function(){m(this).parents(".cut-list__dropdown").addClass("is-show");p(m(this).parents(".cut-list__dropdown").find(".cut-list__more"),i)},function(){h.onBeforeClose(i);m(this).parents(".cut-list__dropdown").removeClass("is-show").find(".cut-list__more").hide().removeClass("is-top is-left");h.onClose(i)})}else{i.find(".cut-list__drop-toggle").on("click",function(){if(m(this).parents(".cut-list__dropdown").is(".is-show")){m(this).parents(".cut-list__dropdown").removeClass("is-show").find(".cut-list__more").hide().removeClass("is-top is-left")}else{m(this).parents(".cut-list__dropdown").addClass("is-show");p(m(this).parents(".cut-list__dropdown").find(".cut-list__more"),i)}});m(document).on("click",function(t){if(m(t.target).closest(".cut-list__dropdown").length)return;h.onBeforeClose(i);m(".cut-list__dropdown.is-show").removeClass("is-show").find(".cut-list__more").hide().removeClass("is-top is-left");h.onClose(i)})}m(w).on("resize",r)}function f(t){e=s;m.when(u(t)).done(function(){a(t)})}function u(i){var t=i.find(".cut-list__more .cut-list__elem");t.each(function(){var t=m(this).data("index");if(t==0)m(this).prependTo(i);else m(this).insertAfter(i.find('.cut-list__elem[data-index="'+(t-1)+'"]'))})}function a(i){n=i.innerWidth();o=i.find(".cut-list__dropdown").outerWidth(true);var t='.cut-list__elem:not(".cut-list__dropdown")';if(l!=-1){o+=i.find(h.alwaysVisibleElem+":first").outerWidth(true);t='.cut-list__elem:not(".cut-list__dropdown,'+h.alwaysVisibleElem+':first")'}i.find(t).each(function(t){o+=m(this).outerWidth(true);if(o>=n){if(l!=-1){if(t>l)e=t+1;else e=t}else e=t;_(i,e);i.addClass("with-more-items").find(".cut-list__dropdown").show();return false}else{i.removeClass("with-more-items").find(".cut-list__dropdown").hide()}})}function _(t,i){var e='.cut-list__elem:not(".cut-list__dropdown")';if(l!=-1)e='.cut-list__elem:not(".cut-list__dropdown,'+h.alwaysVisibleElem+':first")';for(x=i;x<=s;x++){t.find(e+'[data-index="'+x+'"]').appendTo(t.find(".cut-list__more-content"))}if(l!=-1){if(t.find(".cut-list__elem:first").is(h.alwaysVisibleElem)){n=t.innerWidth();o=t.find(".cut-list__dropdown").outerWidth(true)+t.find(h.alwaysVisibleElem+":first").outerWidth(true);if(o>=n){t.find('.cut-list__elem:not(".cut-list__dropdown")[data-index="'+t.find(h.alwaysVisibleElem+":first").data("index")+'"]').appendTo(t.find(".cut-list__more-content"))}}}}function p(t,i){var e=m(document).outerHeight(true);t.css("visibility","hidden").show();h.onBeforeCalc(i);if(t.offset().top+t.innerHeight()>e)t.addClass("is-top");if(t.offset().left<0)t.addClass("is-left");h.onBeforeOpen(i);t.css("visibility","visible");h.onOpen(i)}m.fn.cutList.setup=function(){c(t)};m.fn.cutList.destroy=function(){t.html(i.html());m(w).off("resize",r)}})}})(jQuery,window);